% moirai.sty

\usepackage{tikz}
\usetikzlibrary{calc}

%=======================================================================
% Preliminary commands

\def\l{0.25}

\def\LT{(\l,3*\l)}
\def\T{(2*\l,3*\l)}
\def\RT{(3*\l,3*\l)}
\def\LC{(\l,2*\l)}
\def\C{(2*\l,2*\l)}
\def\RC{(3*\l,2*\l)}
\def\LD{(\l,\l)}
\def\D{(2*\l,\l)}
\def\RD{(3*\l,\l)}

\tikzset{ 
    wire/.style={rounded corners=3, line width=.5pt}
	, iden/.style={line width=.5pt}
	, dot/.style={draw,fill=black, circle, inner sep=1pt}
	, wdot/.style={draw,fill=white, circle, inner sep=1pt}
	, cdot/.style={draw,fill=#1, circle, inner sep=1pt}
  , box/.style={pos=.5,font=\tiny}
  , tag/.style={draw, inner sep=1.5pt}
  , baseline=(current bounding box.center)
}

\usepackage{xparse}

\NewDocumentCommand{\ezs}{o m}{
  \IfNoValueTF{#1}
    {\begin{scope} #2 \end{scope}}
    {\begin{scope}[#1] #2 \end{scope}}
}
\newcommand{\step}[2][1]{\ezs[xshift=#1 cm]{#2}}

\newcommand{\unstep}[2][-1]{\ezs[xshift=#1 cm]{#2}}

\newcommand{\up}[2][1]{
    {\ezs[yshift=#1*\l cm]{#2}}
}

\newcommand{\down}[2][1]{
    {\ezs[yshift=-#1*\l cm]{#2}}
}

\newcommand{\lLabel}[2][0]{\node[left] at (#1,2*\l) {$#2 =\quad$};}
\newcommand{\rLabel}[2]{\node[right] at (#2,2*\l) {$\quad = #1$};}

\newcommand{\gau}[1]{ % à gauche
\node[left] at (0,2*\l) {\tiny $#1$};
}

\newcommand{\dro}[1]{ % à droite
\node[right] at (1,2*\l) {\tiny $#1$};
}

\newcommand{\eql}[1]{ % egalité
\node at (#1,2*\l) {$=$};
}

\newcommand{\yScale}[2][2]{
  \ezs[yscale=#1]{#2}
}

\newcommand{\xScale}[2][2]{
  \ezs[xscale=#1]{#2}
}

%=======================================================================
% Basic shapes

% Akasa (Sanskrit आकाश) is a term for the empty space or æther pervading 
% the cosmos.
\def\akasa{
	\draw[densely dotted] (0,0) rectangle (4*\l,4*\l);
}

\def\braid{
	\draw[wire] (0,\l) -- (\l,\l) -- (3*\l, 3*\l) -- (4*\l,3*\l);
	\draw[wire] (0,3*\l) -- (\l,3*\l) -- (3*\l, \l) -- (4*\l,\l);
}

\def\id{
	\draw[iden] (0,2*\l) -- (4*\l,2*\l);
}

\def\twoid{
	\draw[iden] (0,\l) -- (4*\l,\l);
	\draw[iden] (0,3*\l) -- (4*\l,3*\l);
}

\newcommand{\twoAr}[2][white]{ % two to one arrow == h : A ⊗ B -> C
	\draw[wire] (0,\l) -| (2*\l,3*\l) -- (0,3*\l);
	\draw[wire] (2*\l,2*\l) -- (4*\l,2*\l);
	\draw[fill=#1]
	(\l,\l-.1) rectangle (3*\l,3*\l+.1) node[box] {$#2$};
}

\newcommand{\arTwo}[2][white]{ % one to two arrow == k : A -> B ⊗ C
	\draw[wire] (4*\l,\l) -| (2*\l,3*\l) -- (4*\l,3*\l);
	\draw[wire] (2*\l,2*\l) -- (0,2*\l);
	\draw[fill=#1]
	(\l,\l-.1) rectangle (3*\l,3*\l+.1) node[box] {$#2$};
}

% Not sure if I need these..

\def\turn{
	\draw[wire] (0,\l) -- (\l,\l) -- (3*\l, 3*\l) -- (4*\l,3*\l);
}
\def\coturn{
	\draw[wire] (0,3*\l) -- (\l,3*\l) -- (3*\l, \l) -- (4*\l,\l);
}

% == monoid structure
% the standard structure is black, but an optional parameter allows for 
% different colours.

\newcommand{\mult}[1][black]{
	\draw[wire] (0,\l) -| (2*\l,3*\l) -- (0,3*\l);
	\draw[wire] (2*\l,2*\l) -- (4*\l,2*\l);
	\node[cdot=#1] at (2*\l,2*\l) {};
}

\newcommand{\unit}[1][black]{
	\draw[wire] (2*\l,2*\l) -- (4*\l,2*\l);
	\node[cdot=#1] at (2*\l,2*\l) {};
}

\newcommand{\Tcounit}[2][white]{ % "tagged" counit
	\draw[draw=none] (0,0) rectangle (4*\l,4*\l);
	\draw[wire] (0,2*\l) -- ++(2*\l,0);
	\node[tag, fill=#1] at (2*\l,2*\l) {\tiny $#2$};
}

\newcommand{\mor}[2][white]{
	\draw[draw=none] (0,0) rectangle (4*\l,4*\l);
	\id\node[tag, fill=#1] at (2*\l,2*\l) {\tiny $#2$};
}

% == comonoid structure

\newcommand{\comult}[1][black]{
	\draw[wire] (4*\l,\l) -| (2*\l,3*\l) -- (4*\l,3*\l);
	\draw[wire] (2*\l,2*\l) -- (0,2*\l);
	\node[cdot=#1] at (2*\l,2*\l) {};
}

\newcommand{\counit}[1][black]{
	\draw[wire] (0,2*\l) -- (2*\l,2*\l);
	\node[cdot=#1] at (2*\l,2*\l) {};
}

\newcommand{\Tunit}[2][white]{ % "tagged" unit
	\draw[draw=none] (0,0) rectangle (4*\l,4*\l);
	\draw[wire] (2*\l,2*\l) -- ++(2*\l,0);
	\node[tag, fill=#1] at (2*\l,2*\l) {\tiny $#2$};
}

%=======================================================================
% Upper and lower variants
% U = Up -- D = Down
% L = Labeled

\def\Did{ % identity, down
	\draw[iden] (0,\l) -- (4*\l,\l);
}

\def\Uid{ % identity, up
	\draw[iden] (0,3*\l) -- (4*\l,3*\l);
}

\newcommand{\Dmor}[2][white]{ % down morphism
	\draw[draw=none] (0,0) rectangle (4*\l,4*\l);
	\Did
	\node[tag, fill=#1] at (2*\l,\l) {\tiny $#2$};
}

\newcommand{\Umor}[2][white]{ % up morphism
	\draw[draw=none] (0,0) rectangle (4*\l,4*\l);
	\Uid
	\node[tag, fill=#1] at (2*\l,3*\l) {\tiny $#2$};
}

\NewDocumentCommand{\UDmor}{O{white} m O{white} m}{ % up n down morphism
\Umor[#1]{#2}
\Dmor[#3]{#4}
}

\newcommand{\DDmor}[2][white]{
	\Uid\Dmor[#1]{#2}
}
\newcommand{\UUmor}[2][white]{
	\Did\Umor[#1]{#2}
}
\newcommand{\Dcomult}[1][black]{ % comultiplication, down
	\draw[wire] (4*\l,0) -| (2*\l,2*\l) -- (4*\l,2*\l);
	\draw[wire] (2*\l,\l) -- (0,\l);
	\node[cdot=#1] at (2*\l,\l) {};
}

\newcommand{\Ucomult}[1][black]{ % comultiplication, up
	\draw[wire] (4*\l,2*\l) -| (2*\l,4*\l) -- (4*\l,4*\l);
	\draw[wire] (2*\l,3*\l) -- (0,3*\l);
	\node[cdot=#1] at (2*\l,3*\l) {};
}

\newcommand{\Uunit}[1][black]{ % unit, up
	\draw[wire] (4*\l,3*\l) -- (2*\l,3*\l);
	\node[cdot=#1] at (2*\l,3*\l) {};
}

\newcommand{\Dunit}[1][black]{ % unit, down
	\draw[wire] (4*\l,\l) -- (2*\l,\l);
	\node[cdot=#1] at (2*\l,\l) {};
}

\newcommand{\Ucounit}[1][black]{ % counit, up
	\draw[wire] (0,3*\l) -- (2*\l,3*\l);
	\node[cdot=#1] at (2*\l,3*\l) {};
}

\newcommand{\Dcounit}[1][black]{ % counit, down
	\draw[wire] (0,\l) -- (2*\l,\l);
	\node[cdot=#1] at (2*\l,\l) {};
}

\newcommand{\DTunit}[2][white]{ % tagged counit, down
	\draw[wire] (2*\l,\l) -- ++(2*\l,0);
	\node[tag, fill=#1] at (2*\l,\l) {$#2$};
}

\newcommand{\UTunit}[2][white]{ % tagged counit, up
	\draw[wire] (2*\l,3*\l) -- ++(2*\l,0);
	\node[tag, fill=#1] at (2*\l,3*\l) {$#2$};
}

\newcommand{\DTcounit}[2][white]{ % tagged counit, down
	\draw[wire] (2*\l,\l) -- ++(-2*\l,0);
	\node[tag, fill=#1] at (2*\l,\l) {$#2$};
}

\newcommand{\UTcounit}[2][white]{ % tagged counit, up
	\draw[wire] (2*\l,3*\l) -- ++(-2*\l,0);
	\node[tag, fill=#1] at (2*\l,3*\l) {$#2$};
}

%=======================================================================
% Other strings

\newcommand{\Cup}{
	\draw[wire] (0,\l) -| (2*\l,3*\l) -- (0,3*\l);
}

\newcommand{\Cap}{
	\draw[wire] (4*\l,\l) -| (2*\l,3*\l) -- (4*\l,3*\l);
}

\newcommand{\DCup}{
	\draw[wire] (0,0) -| (2*\l,2*\l) -- (0,2*\l);
}

\newcommand{\DCap}{
	\draw[wire] (4*\l,0) -| (2*\l,2*\l) -- (4*\l,2*\l);
}

\newcommand{\TCup}{
	\draw[wire] (0,2*\l) -| (2*\l,4*\l) -- (0,4*\l);
}

\newcommand{\TCap}{
	\draw[wire] (4*\l,2*\l) -| (2*\l,4*\l) -- (4*\l,4*\l);
}

%=======================================================================
% The canvas

%  ------------------+------------------+------------------+------------------ 
% ||                                                                          ||
% ||                 |                  |                  |                  ||
% ||                 |                  |                  |                  ||
% ||                 |                  |                  |                  ||
% || ---------------TL------------------T-----------------TR----------------- ||
% ||                 |                  |                  |                  ||
% ||                 |                  |                  |                  ||
% ||                 |                  |                  |                  ||
% ||                 |                  |                  |                  ||
% || ---------------CL------------------C-----------------CR----------------- ||
% ||                 |                  |                  |                  ||
% ||                 |                  |                  |                  ||
% ||                 |                  |                  |                  ||
% ||                 |                  |                  |                  ||
% || ---------------DL------------------D-----------------DR----------------- ||
% ||                 |                  |                  |                  ||
% ||                 |                  |                  |                  ||
% ||                 |                  |                  |                  ||
% ||                                                                          ||
%   -----------------+------------------+------------------+------------------ 

%=======================================================================
% Things to reorder


% \def\multi#1{
% % \foreach \i in {0,1,2,3}{
% % \draw[wire] (0,\l/2+\i*\l) -- ++(\l,0);}
% \draw[wire] (0,5*\l) -| (2*\l,7*\l) -- (0,7*\l);
% \draw[wire] (0,\l) -| (2*\l,3*\l) -- (0,3*\l);
% \ezs{\draw[wire] (3*\l,2*\l) -- ++(\l,0);
% \draw[fill=white, thin] (\l,\l-.15) rectangle (3*\l,3*\l+.15) node[pos=.5,] {$\scriptscriptstyle #1$};}{yscale=2}
% }

% \def\theR{\ucounit
% \lcounit
% \draw[fill=white] (\l,\l-.1) rectangle (3*\l,3*\l+.1) node[box] {\tiny $R$};}